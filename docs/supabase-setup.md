# Настройка Supabase для US-201: Auth и роли

## 1. Создание проекта Supabase

1. Перейдите на [supabase.com](https://supabase.com)
2. Создайте новый проект
3. Запишите URL и anon key

## 2. Настройка переменных окружения

Создайте файл `.env.local` в корне проекта:

```env
VITE_SUPABASE_URL=your_supabase_url
VITE_SUPABASE_ANON_KEY=your_supabase_anon_key
```

## 3. Настройка схемы БД

1. Откройте SQL Editor в Supabase Dashboard
2. Выполните миграции в порядке:
   - `sql/01-auth-setup.sql` - RLS политики и индексы
   - `sql/02-seed-data.sql` - тестовые данные

## 4. Настройка аутентификации

1. В Supabase Dashboard перейдите в Authentication > Settings
2. Включите "Enable email confirmations"
3. Настройте URL для redirect: `http://localhost:5173/auth/callback`
4. Включите "Enable email signup"

## 5. Настройка RLS

RLS политики уже настроены в `sql/01-auth-setup.sql`. Они обеспечивают:

- Пользователи видят только свои организации
- Роли определяют права доступа
- Публичный доступ к экранам игр
- Безопасность мульти-тенантности

## 6. Тестирование

1. Запустите проект: `npm run dev`
2. Перейдите на `/login`
3. Введите email и получите Magic Link
4. После входа вы попадёте в админку `/admin`

## 7. Роли и права доступа

### Owner (Владелец)
- Полный доступ ко всем функциям
- Управление биллингом
- Удаление организации

### Admin (Администратор)
- Управление пользователями
- Создание и редактирование игр
- Управление пакетами
- Просмотр аналитики

### Host (Ведущий)
- Создание и проведение игр
- Просмотр экранов
- Ограниченное управление

### Viewer (Наблюдатель)
- Только просмотр экранов
- Минимальные права

## 8. Структура БД

Основные таблицы:
- `orgs` - организации
- `memberships` - членство пользователей в организациях
- `games` - игры
- `teams` - команды
- `categories` - категории вопросов
- `questions` - вопросы
- `question_packs` - пакеты вопросов
- `score_events` - события очков
- `sessions` - сессии игроков
- `players` - игроки

## 9. Безопасность

- Все таблицы защищены RLS
- Роли проверяются на уровне БД
- Публичный доступ только к экранам
- Аудит всех изменений

## 10. Следующие шаги

После настройки US-201 можно переходить к:
- US-202: CRUD игр
- US-203: CRUD категорий и вопросов
- US-204: Управление командами
